<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试教育水平模态框</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <h1>测试教育水平模态框功能</h1>
        
        <!-- 基础信息表单 -->
        <div class="form-container">
            <h2>基本信息</h2>
            
            <!-- 当前教育水平 -->
            <div class="form-group">
                <div class="form-label-with-help">
                    <label class="form-label">当前教育水平</label>
                    <button type="button" class="help-icon" id="educationLevelHelpBtn" title="查看不同教育水平的特点对比">
                        <span class="help-text">?</span>
                    </button>
                </div>
                <div class="option-grid" id="currentLevelOptions">
                    <button type="button" class="option-btn active" data-value="公立">公立</button>
                    <button type="button" class="option-btn" data-value="普通私立">普通私立</button>
                    <button type="button" class="option-btn" data-value="民办双语">民办双语</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 教育水平特点模态框 -->
    <div class="modal-overlay" id="educationLevelModal" style="display: none;">
        <div class="modal-container">
            <div class="modal-header">
                <h3 class="modal-title">教育水平核心特点对比</h3>
                <button type="button" class="modal-close-btn" id="closeModalBtn">×</button>
            </div>
            <div class="modal-body">
                <div class="education-level-guide">
                    <p class="guide-intro">了解不同教育水平的特色优势，帮助您做出明智的选择：</p>
                    
                    <!-- 教育阶段选择器 -->
                    <div class="stage-selector">
                        <label class="selector-label">选择教育阶段：</label>
                        <div class="stage-tabs" id="stageTabsModal">
                            <button type="button" class="stage-tab active" data-stage="幼儿园">幼儿园</button>
                            <button type="button" class="stage-tab" data-stage="小学">小学</button>
                            <button type="button" class="stage-tab" data-stage="初中">初中</button>
                            <button type="button" class="stage-tab" data-stage="高中">高中</button>
                            <button type="button" class="stage-tab" data-stage="大学">大学</button>
                            <button type="button" class="stage-tab" data-stage="研究生">研究生</button>
                            <button type="button" class="stage-tab" data-stage="博士">博士</button>
                        </div>
                    </div>
                    
                    <!-- 教育水平特点展示区域 -->
                    <div class="levels-comparison" id="levelsComparison">
                        <!-- 动态生成的教育水平特点对比内容 -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="modalConfirmBtn">我知道了</button>
            </div>
        </div>
    </div>

    <!-- 脚本 -->
    <script src="js/education-level-features.js"></script>
    <script>
        class TestApp {
            constructor() {
                this.educationLevelFeatures = new EducationLevelFeaturesService();
                
                // 教育阶段与水平的映射关系
                this.stageLevelMapping = {
                    '幼儿园': ['公立', '普通私立', '民办双语'],
                    '小学': ['公立', '普通私立', '民办双语'],
                    '初中': ['公立', '普通私立', '民办双语'],
                    '高中': ['公立', '民办普通高中', '公立国际部', '民办国际化学校', '海外高中'],
                    '大学': ['国内公办', '国内民办', '中外合作办学', '海外大学'],
                    '研究生': ['国内硕士', '海外硕士'],
                    '博士': ['国内博士', '海外博士']
                };
                
                this.bindEvents();
            }
            
            bindEvents() {
                // 帮助按钮
                const helpBtn = document.getElementById('educationLevelHelpBtn');
                if (helpBtn) {
                    helpBtn.addEventListener('click', () => {
                        this.showEducationLevelModal();
                    });
                }
                
                // 关闭按钮
                const closeBtn = document.getElementById('closeModalBtn');
                const confirmBtn = document.getElementById('modalConfirmBtn');
                const modal = document.getElementById('educationLevelModal');
                
                if (closeBtn) {
                    closeBtn.addEventListener('click', () => {
                        this.hideEducationLevelModal();
                    });
                }
                
                if (confirmBtn) {
                    confirmBtn.addEventListener('click', () => {
                        this.hideEducationLevelModal();
                    });
                }
                
                if (modal) {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            this.hideEducationLevelModal();
                        }
                    });
                }
                
                // 阶段选择器
                const stageTabs = document.getElementById('stageTabsModal');
                if (stageTabs) {
                    stageTabs.addEventListener('click', (e) => {
                        if (e.target.classList.contains('stage-tab')) {
                            // 移除所有active状态
                            stageTabs.querySelectorAll('.stage-tab').forEach(tab => {
                                tab.classList.remove('active');
                            });
                            // 添加当前选中的active状态
                            e.target.classList.add('active');
                            // 更新模态框内容
                            const selectedStage = e.target.dataset.stage;
                            this.updateModalLevelsComparison(selectedStage);
                        }
                    });
                }
            }
            
            showEducationLevelModal() {
                const modal = document.getElementById('educationLevelModal');
                if (modal) {
                    modal.style.display = 'flex';
                    this.updateModalLevelsComparison('幼儿园');
                    document.body.style.overflow = 'hidden';
                }
            }
            
            hideEducationLevelModal() {
                const modal = document.getElementById('educationLevelModal');
                if (modal) {
                    modal.style.display = 'none';
                    document.body.style.overflow = '';
                }
            }
            
            updateModalLevelsComparison(stage) {
                const levelsComparison = document.getElementById('levelsComparison');
                if (!levelsComparison) return;

                const levels = this.stageLevelMapping[stage] || [];
                
                if (levels.length === 0) {
                    levelsComparison.innerHTML = '<p class="text-muted">该阶段暂无详细特点信息</p>';
                    return;
                }

                const levelCards = levels.map(level => {
                    const featureInfo = this.educationLevelFeatures.getFullFeatureInfo(stage, level);
                    
                    if (!featureInfo || !featureInfo.hasInfo) {
                        return `
                            <div class="level-card">
                                <div class="level-header">
                                    <h4 class="level-name">${level}</h4>
                                </div>
                                <div class="level-features">
                                    暂无详细特点信息
                                </div>
                            </div>
                        `;
                    }

                    const formattedFeatures = featureInfo.features.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

                    return `
                        <div class="level-card">
                            <div class="level-header">
                                <h4 class="level-name">${level}</h4>
                                <span class="level-badge">${stage}</span>
                            </div>
                            <div class="level-features">
                                ${formattedFeatures}
                            </div>
                            <div class="level-meta">
                                <div class="meta-item">
                                    <span class="meta-label">国籍要求：</span>
                                    <span class="meta-value">${featureInfo.nationalityRequirement || '无特殊要求'}</span>
                                </div>
                                <div class="meta-item">
                                    <span class="meta-label">学籍情况：</span>
                                    <span class="meta-value">${featureInfo.studentStatus === '有' ? '有国内学籍' : featureInfo.studentStatus === '无' ? '无国内学籍' : featureInfo.studentStatus}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                levelsComparison.innerHTML = levelCards;
            }
        }
        
        // 初始化测试应用
        document.addEventListener('DOMContentLoaded', () => {
            new TestApp();
        });
    </script>
</body>
</html>
