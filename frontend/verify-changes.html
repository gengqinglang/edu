<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>可行性调整验证</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #4A90A4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #3A7384;
        }
        .result {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #4A90A4;
        }
        .success {
            border-left-color: #10B981;
            background: #f0fdf4;
        }
        .error {
            border-left-color: #EF4444;
            background: #fef2f2;
        }
        .verification-item {
            background: white;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            border-left: 3px solid #4A90A4;
        }
        .verification-item.pass {
            border-left-color: #10B981;
            background: #f0fdf4;
        }
        .verification-item.fail {
            border-left-color: #EF4444;
            background: #fef2f2;
        }
    </style>
</head>
<body>
    <h1>可行性调整验证</h1>
    
    <div class="test-section">
        <h2>验证项目</h2>
        <p>验证可行性分类已从三种（feasible、conditional、infeasible）调整为两种（feasible、infeasible）</p>
        
        <button class="test-button" onclick="runVerification()">运行验证</button>
        <div id="verificationResult" class="result" style="display: none;"></div>
    </div>

    <div class="test-section">
        <h2>测试用例</h2>
        <button class="test-button" onclick="testCase1()">测试：初中公立 -> 研究生</button>
        <button class="test-button" onclick="testCase2()">测试：高中民办国际化学校 -> 博士</button>
        <div id="testResult" class="result" style="display: none;"></div>
    </div>

    <script src="js/education-data.js"></script>
    <script src="js/path-finder.js"></script>
    <script>
        function displayResult(resultId, content, isError = false) {
            const resultDiv = document.getElementById(resultId);
            resultDiv.innerHTML = content;
            resultDiv.className = `result ${isError ? 'error' : 'success'}`;
            resultDiv.style.display = 'block';
        }

        function runVerification() {
            let content = '<h3>验证结果</h3>';
            let allPassed = true;

            // 验证1: 检查规则数据中是否还有 conditional
            const hasConditional = EDUCATION_TRANSITION_RULES.some(rule => rule.feasibility === 'conditional');
            const verification1 = hasConditional ? 'fail' : 'pass';
            if (hasConditional) allPassed = false;
            content += `<div class="verification-item ${verification1}">
                <strong>验证1:</strong> 规则数据中无 conditional 状态 - ${hasConditional ? '❌ 失败' : '✅ 通过'}
            </div>`;

            // 验证2: 检查可行性状态只有两种
            const feasibilityTypes = [...new Set(EDUCATION_TRANSITION_RULES.map(rule => rule.feasibility))];
            const hasOnlyTwoTypes = feasibilityTypes.length === 2 && 
                                  feasibilityTypes.includes('feasible') && 
                                  feasibilityTypes.includes('infeasible');
            const verification2 = hasOnlyTwoTypes ? 'pass' : 'fail';
            if (!hasOnlyTwoTypes) allPassed = false;
            content += `<div class="verification-item ${verification2}">
                <strong>验证2:</strong> 可行性状态只有两种（feasible、infeasible） - ${hasOnlyTwoTypes ? '✅ 通过' : '❌ 失败'}
                <br><small>实际状态: ${feasibilityTypes.join(', ')}</small>
            </div>`;

            // 验证3: 测试路径查找功能
            try {
                const testInput = {
                    currentStage: '初中',
                    currentGrade: 3,
                    currentLevel: '公立',
                    targetStage: '研究生'
                };
                const result = findAllPaths(testInput);
                const resultFeasibilityTypes = [...new Set(result.paths.map(path => path.feasibility))];
                const hasOnlyTwoResultTypes = resultFeasibilityTypes.length <= 2 && 
                                            resultFeasibilityTypes.every(type => ['feasible', 'infeasible'].includes(type));
                const verification3 = hasOnlyTwoResultTypes ? 'pass' : 'fail';
                if (!hasOnlyTwoResultTypes) allPassed = false;
                content += `<div class="verification-item ${verification3}">
                    <strong>验证3:</strong> 路径查找结果只有两种可行性状态 - ${hasOnlyTwoResultTypes ? '✅ 通过' : '❌ 失败'}
                    <br><small>结果状态: ${resultFeasibilityTypes.join(', ')}</small>
                </div>`;
            } catch (error) {
                allPassed = false;
                content += `<div class="verification-item fail">
                    <strong>验证3:</strong> 路径查找功能测试 - ❌ 失败
                    <br><small>错误: ${error.message}</small>
                </div>`;
            }

            // 验证4: 检查统计信息
            try {
                const testInput = {
                    currentStage: '初中',
                    currentGrade: 3,
                    currentLevel: '公立',
                    targetStage: '研究生'
                };
                const result = findAllPaths(testInput);
                const hasConditionalPaths = 'conditionalPaths' in result;
                const verification4 = !hasConditionalPaths ? 'pass' : 'fail';
                if (hasConditionalPaths) allPassed = false;
                content += `<div class="verification-item ${verification4}">
                    <strong>验证4:</strong> 统计信息中无 conditionalPaths 字段 - ${!hasConditionalPaths ? '✅ 通过' : '❌ 失败'}
                </div>`;
            } catch (error) {
                allPassed = false;
                content += `<div class="verification-item fail">
                    <strong>验证4:</strong> 统计信息验证 - ❌ 失败
                    <br><small>错误: ${error.message}</small>
                </div>`;
            }

            content += `<div style="margin-top: 20px; padding: 15px; background: ${allPassed ? '#f0fdf4' : '#fef2f2'}; border-radius: 8px; border-left: 4px solid ${allPassed ? '#10B981' : '#EF4444'};">
                <strong>总体结果:</strong> ${allPassed ? '✅ 所有验证通过' : '❌ 部分验证失败'}
            </div>`;

            displayResult('verificationResult', content, !allPassed);
        }

        function testCase1() {
            try {
                const input = {
                    currentStage: '初中',
                    currentGrade: 3,
                    currentLevel: '公立',
                    targetStage: '研究生'
                };
                
                const result = findAllPaths(input);
                
                let content = `<h3>测试结果</h3>`;
                content += `<p><strong>输入:</strong> ${JSON.stringify(input, null, 2)}</p>`;
                content += `<p><strong>总路径数:</strong> ${result.totalPaths}</p>`;
                content += `<p><strong>可行路径:</strong> ${result.feasiblePaths}</p>`;
                content += `<p><strong>不可行路径:</strong> ${result.infeasiblePaths}</p>`;
                
                // 检查是否还有 conditionalPaths
                if ('conditionalPaths' in result) {
                    content += `<p style="color: red;"><strong>⚠️ 警告:</strong> 结果中仍包含 conditionalPaths: ${result.conditionalPaths}</p>`;
                }
                
                if (result.paths.length > 0) {
                    content += `<h4>前2条路径的可行性状态:</h4>`;
                    result.paths.slice(0, 2).forEach((path, index) => {
                        content += `<div style="margin: 10px 0; padding: 10px; background: white; border-radius: 4px;">`;
                        content += `<strong>路径 ${index + 1}:</strong> ${path.feasibility}<br>`;
                        content += `<em>${path.description}</em>`;
                        content += `</div>`;
                    });
                }
                
                displayResult('testResult', content);
            } catch (error) {
                displayResult('testResult', `<h3>测试失败</h3><p>错误: ${error.message}</p>`, true);
            }
        }

        function testCase2() {
            try {
                const input = {
                    currentStage: '高中',
                    currentGrade: 2,
                    currentLevel: '民办国际化学校',
                    targetStage: '博士'
                };
                
                const result = findAllPaths(input);
                
                let content = `<h3>测试结果</h3>`;
                content += `<p><strong>输入:</strong> ${JSON.stringify(input, null, 2)}</p>`;
                content += `<p><strong>总路径数:</strong> ${result.totalPaths}</p>`;
                content += `<p><strong>可行路径:</strong> ${result.feasiblePaths}</p>`;
                content += `<p><strong>不可行路径:</strong> ${result.infeasiblePaths}</p>`;
                
                // 检查是否还有 conditionalPaths
                if ('conditionalPaths' in result) {
                    content += `<p style="color: red;"><strong>⚠️ 警告:</strong> 结果中仍包含 conditionalPaths: ${result.conditionalPaths}</p>`;
                }
                
                if (result.paths.length > 0) {
                    content += `<h4>所有路径的可行性状态:</h4>`;
                    const feasibilityCounts = {};
                    result.paths.forEach(path => {
                        feasibilityCounts[path.feasibility] = (feasibilityCounts[path.feasibility] || 0) + 1;
                    });
                    
                    Object.entries(feasibilityCounts).forEach(([feasibility, count]) => {
                        content += `<div style="margin: 5px 0; padding: 5px; background: white; border-radius: 4px;">`;
                        content += `<strong>${feasibility}:</strong> ${count} 条路径`;
                        content += `</div>`;
                    });
                }
                
                displayResult('testResult', content);
            } catch (error) {
                displayResult('testResult', `<h3>测试失败</h3><p>错误: ${error.message}</p>`, true);
            }
        }
    </script>
</body>
</html>
